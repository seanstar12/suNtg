//These functions get loaded to the page via loader.js
//You have access to these functions on the site for debugging.
//This file is broken up into 3 sections:
//  Section 1: Bug fixes on site
//  Section 2: General helper functions
//  Section 3: Feature additions

/////////////////////////
//Section 1: Bug Fixes://
/////////////////////////

//Required for checkFix, addInNewTab, and General Page functions.
document.scripts[1].parentNode.removeChild(document.scripts[1]);

//Fix juniper switch pages for automatic checkbox selection on edit
function checkFix(){
  var el = document.getElementsByName('Update');
  for (i=0; i < el.length; i++) el[i].id = (el[i].id).replace(' ',''); 
}

//Open 'add link' in new tab.
function openSelectLinkWindow(ObjID, LinkPortInfo){ 
  (window.open("LinkSelect.asp?LocalPort=" + ObjID + "_" + LinkPortInfo,"_blank")).focus();
}


/////////////////
//End Section 1//
/////////////////

////////////////////////////////
//Section 2: Helper Functions://
////////////////////////////////

function checkChanged(fName, num){
  num = num.replace(' ','')
  eval("document.forms['"+ fName + "'].Update_" + num + ".checked = true");
}

function returnDate(){
  var currentDate = new Date();
  var day = currentDate.getDate();
  var month = currentDate.getMonth() +1;
  var year = currentDate.getFullYear();
  var date = month + "/" + day + "/" + year;
  return date;
}

function getUrlVars() {
  var vars = {};
  var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
      vars[key] = value;
  });
  return vars;
}

/////////////////
//End Section 2//
/////////////////

///////////////////////////////
//Section 3: Feture Additions//
///////////////////////////////

function deallocateTag(xtag){
  var http = new XMLHttpRequest();
  http.onreadystatechange = function(){
    if (http.readyState == 4 && http.status == 200) {
      var div = document.createElement("div");
      //div.setAttribute("style",'display: none;');
      div.innerHTML = http.responseText;
      document.getElementsByClassName('Main')[0].appendChild(div);
      //document.forms['detailform'].command.value = "Deallocate";
      //document.forms['detailform'].submit();
    }
    
  }
  //http.open("GET","https://ntg.missouristate.edu/NetInfo/EquipmentDetail.asp?Tag="+xtag);
  //http.send(); 
}


function addLinks() {
  var el = document.createElement('div');
  var ul = document.createElement('ul');
  el.className = "selectList";

  var name = (document.getElementsByClassName('Content')[0].children[0].innerHTML);
  name = name.split(' ');
  
  var k =0;
  var content = "";
  var item = document.getElementsByClassName('NetHeading');
  var length = item.length;
  if (length < 3 ) return false; 
  else {
    for (var j=1;j<length;j+=2){
      content += "<li><a href=\"#switch_"+(j-1)+"\">(<span class=\"gE\">"+k+"/0</span>-</a></li>";
      content += "<li><a href=\"#switch_"+(j)+"\"><span class=\"xE\">"+k+"/1</span>)</a></li>";
      k++;
    }
    for (var i=1; i< length; i++){
      item[i].innerHTML += "<span id=\"switch_"+(i-1)+"\" class=\"sL\">"+name[2]+ " " +content+"</div>"; 
    }
  }
}



function autoDate() {
  var dateArray = document.getElementsByName('dbdVerifyDt');
  var check = document.getElementsByName('Update');

  var cDate = new Date();
  var day = cDate.getDate();
  var month = cDate.getMonth() +1;
  var year = cDate.getFullYear() -1;
  var date = month + "/" + day + "/" + year;

  for (var i = 0; i < dateArray.length; i++) {
    dateArray[i].value= date;
  }
  for (var k = 0; k < check.length; k++){
    check[k].checked= true;
  }
}

//<input type="submit" value="Update" name="cmdSubmit" title="Update selected records WITH date">
function addButtons(){
  var forms = document.forms;
  for (var i=0; i<forms.length;i++){
    var button = document.createElement('input');
    button.setAttribute('type','submit');
    button.setAttribute('value',getDate());
    button.setAttribute('id','cmdSubmitDate');
    button.setAttribute('title','Update With date');
    forms[i].appendChild(button);
  }
}

function fillDate(){
  var date = document.getElementById('dbInventory_d_VerifyDt').value;

  if (document.getElementsByClassName('NetWarning') && date.length == 0){
    document.getElementById('dbInventory_d_VerifyDt').value = returnDate();
    document.forms.detailform.cmdSubmit.click();
  }
}

function setObjId() { //Sets URL to have objid. No More Post reuqests. :D
  id = document.forms[0].children[0].value;
  url = (document.URL).toLowerCase();
  if (url.indexOf('objid') < 0) {
    document.body.style.display = "none";
    window.location += "?ObjId=" + id + "&f=1";
  }
}
 

/////////////////
//End Section 3//
/////////////////

